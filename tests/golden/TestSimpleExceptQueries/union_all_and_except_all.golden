`
Query:

SELECT * FROM locations
UNION ALL
SELECT * FROM locations
EXCEPT ALL
(
SELECT l.* FROM locations l
JOIN regions r ON r.region_id = l.region_id
WHERE r.region_name = 'NA'
)
ORDER BY region_id, location_id

Plan:

                                                query plan
----------------------------------------------------------------------------------------------------------
 select (location_id, location_name, region_id)
    order by region_id, location_id
        union
            select (location_id, location_name, region_id)
                table scan of locations
        with
            select (location_id, location_name, region_id)
                combination
                    select (location_id, location_name, region_id)
                        table scan of locations
                with
                    select (location_id, location_name, region_id)
                        join using nested loop
                            alias as l
                                table scan of locations
                        with
                            alias as r
                                table scan of regions
                                    filter: regions.region_name = NA and regions.region_id = l.region_id
                        on r.region_id = l.region_id

(1 rows)

Results:

 location_id | location_name | region_id
-------------+---------------+-----------
           1 | San Francisco |         1
           2 |       Toronto |         1
           3 |      New York |         1
           4 |     Barcelona |         2
           4 |     Barcelona |         2
           5 |     Cape Town |         2
           5 |     Cape Town |         2
           6 |     Guangzhou |         2
           6 |     Guangzhou |         2
(9 rows)
`
